<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="template/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="template/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="template/css/fontastic.css">
    <!-- Google fonts - Poppins -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="template/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="template/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="template/img/favicon.ico">
    <style>
        .zky-table {
            max-width: 80%;
            margin: 0 auto;
            width: 80%;
            flex: auto;
        }

        .has-shadow {
            margin-right: 30px;
        }
        .dismiss{
            /*position: absolute;*/
            float: right;
            top: 50%;
            right: 20px;
            -webkit-transform: translateY(100%);
            transform: translateY(100%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            color: #999;
        }
        .searchResult li {
            border-bottom: 1px solid #e4e7ee;
            line-height: 30px;
            /* padding-left: 4px; */
            width: 100%;
            list-style: none;
        }

    </style>
    <!-- JavaScript files-->
    <script src="template/vendor/jquery/jquery.min.js"></script>
    <script src="template/vendor/popper.js/umd/popper.min.js"></script>
    <script src="template/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="template/vendor/jquery.cookie/jquery.cookie.js"></script>
    <script src="template/vendor/chart.js/Chart.min.js"></script>
    <script src="template/vendor/vue/vue.min.js"></script>
    <script src="template/vendor/jquery-validation/jquery.validate.min.js"></script>
    <!-- Main File-->
    <script src="template/js/front.js"></script>
    <script src="js/Url.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            // do something...
            let formRequest = new Request(URL.ListSecondHandPublish, {
                method: 'post',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;'
                },
                // body: 'person=201806060231'
                credentials: 'include',

            })
            fetch(formRequest).then(response => {
                let result = response.json()
                result.then(res => {
                    window.data = res.data
                    console.log(res)
                    $.each(window.data, function (j, res) {
                        let temp = "<tr class='tr1'>"
                        let t1 = "<th scope = 'row'>" + parseInt(j + 1) + "</th>"
                        let t5 = "<td>" + "<img width='50px' height='50px' src='" + URL.GetImage + "?id=" + res.book.cover + "'>" + "</td>"
                        let t2 = "<td class='person_id'>" + res.person.id + "</td>"
                        let t7 = "<td class='book_name'>" + res.book.name + "</td>"
                        let t8 = "<td>" + res.book.isbn + "</td>"
                        let t4 = "<td class='price'>" + res.price + "</td>"
                        let t6 = "<td><button data-toggle=\"modal\" data-target=\"#myModal\" class=\"btn btn-primary\" onclick='dealOrder(this)'>购买</button></td>"
                        let temp_end = "</tr>"
                        // console.log(temp + t1 + t2 + t3 + t4 + temp_end)
                        $(".table").append(temp + t1 + t5 + t2 + t7 + t8 + t4 + t6 + temp_end)
                        // alert(items+'------'+j);
                    })
                })
            })

            var searchItem = '';//搜索框内容
            var pageNum = 1;//默认page
            // console.log(1111)
            //监听搜索框输入事件，有内容的话就进行查询
            console.log(111)
            $('.inputName').on('input', function () {
                console.log(111)
                var _v = $.trim($(this).val());
                // console.log(_v)
                $('#searchResult').empty();
                $('#searchResult').show();
                pageNum = 1;
                if (_v !== '') {
                    searchItem = _v;
                    searchShopFn(_v);
                }
            });

            /**
             * 搜索结果的下拉加载更多，每页显示十条，如果搜索结果多余十条，下拉对应的列表，会自动把其他数据添加进来
             * @method  nextLoad()

             * @return {data}
             */


            //点击每条数据给搜索框赋值，同时需要重新设置对应的参数
            $(document).on('click', '.searchResult li', function () {
                var _v = $(this).text();
                var _shopId = $(this).attr('shopId');
                // console.log("I WANT TO SHOW ISBN"+_shopId)
                $('.inputName').val(_v)
                $('#searchResult').hide();
                // $('.display-ISBN').attr('placeholder',_shopId)
                let url = URL.SelectSecondHandPublishByIsbn
                let body="isbn="+_shopId
                const refreshFuzzy =(res)=>{
                    // window.resd = res.data
                    console.log("here is a callback")
                    console.log(res)
                    fuzzySearch(res.data[0].book.name)
                }
                request(url,body,refreshFuzzy)

                // isHasnextPage = false;
                // return false;

            });

            //模糊查询ajax请求数据  keyWord就是关键词，pageNum是对应的页码
            function searchShopFn(keyWord) {
                $.ajax({
                    url: URL.FuzzyBook,//请求数据的地址，
                    dataType: "json",
                    method: 'post',
                    data: {
                        name: keyWord,
                    },xhrFields: {
                        withCredentials: true // 携带跨域cookie
                    },
                    success: function (res) {
                        window.liAry = res.data;
                        console.log(liAry)
                        var liAryTotal = res.data.total;
                        // // isHasnextPage = (pageNum * 10 < liAryTotal) ? true : false;
                        var m = '';
                        $.each(liAry, function (i, v) {

                            m += '<li shopId="' + v.isbn + '" title="' + v.name + '">' + v.name + '</li>';
                            console.log(m)
                        });
                        $('#searchResult').append(m);

                    }, error: function (res) {
                        // console.log(error)
                    }

                })
            }


        }

        const dealOrder = function (which) {
            // console.log($(".modal-body h4")[0].innerHTML)
            let outTh = $(which).parent().parent(".tr1")
            $(".modal-body h3")[0].innerHTML = '发货人学号为：' + outTh.children(".person_id")[0].innerHTML
            // var imgurl=$(this).find('img').attr('src')

            $(".modal-body  small")[0].innerHTML='书籍名称为：'+outTh.children('.book_name')[0].innerHTML
            $(".modal-body").find('img').attr('src', outTh.find('img').attr('src'))
            $('.h3').attr('placeholder','确认价格：'+outTh.children('.price')[0].innerHTML )


        };
        const initOrder = function (){
            $('.inputName').val('')
            $.each($('.tr1'),function (k,v){
                $(this).remove()
                // // console.log($(this).children('.book_name')[0].innerHTML)
                // if($(this).children('.book_name')[0].innerHTML  !== data){
                //     $(this).remove()
                // }
            })
            $.each(window.data, function (j, res) {
                let temp = "<tr class='tr1'>"
                let t1 = "<th scope = 'row'>" + parseInt(j + 1) + "</th>"
                let t5 = "<td>" + "<img width='50px' height='50px' src='" + URL.GetImage + "?id=" + res.book.cover + "'>" + "</td>"
                let t2 = "<td class='person_id'>" + res.person.id + "</td>"
                let t7 = "<td class='book_name'>" + res.book.name + "</td>"
                let t8 = "<td>" + res.book.isbn + "</td>"
                let t4 = "<td class='price'>" + res.price + "</td>"
                let t6 = "<td><button data-toggle=\"modal\" data-target=\"#myModal\" class=\"btn btn-primary\" onclick='dealOrder(this)'>购买</button></td>"
                let temp_end = "</tr>"
                // console.log(temp + t1 + t2 + t3 + t4 + temp_end)
                $(".table").append(temp + t1 + t5 + t2 + t7 + t8 + t4 + t6 + temp_end)
                // alert(items+'------'+j);
            })
        //     $.each(liAry, function (i, v) {
        //
        //         m += '<li shopId="' + v.isbn + '" title="' + v.name + '">' + v.name + '</li>';
        //         console.log(m)
        //     });
        //     $('#searchResult').append(m);
        }
        const fuzzySearch = function (data){
            $.each($('.tr1'),function (k,v){
                // console.log($(this).children('.book_name')[0].innerHTML)
                if($(this).children('.book_name')[0].innerHTML  !== data){
                    $(this).remove()
                }
            })
        }

    </script>
</head>
<body>
<div class="page">
    <!-- Main Navbar-->
    <header class="header">
        <nav class="navbar">
            <!-- Search Box-->
            <div class="search-box">
                <button class="dismiss"><i class="icon-close"></i></button>
                <form id="searchForm" action="#" role="search">
                    <input type="search" placeholder="What are you looking for..." class="form-control">
                </form>
            </div>
            <div class="container-fluid">
                <div class="navbar-holder d-flex align-items-center justify-content-between">
                    <!-- Navbar Header-->
                    <div class="navbar-header">
                        <!-- Navbar Brand --><a href="index.html" class="navbar-brand d-none d-sm-inline-block">
                        <div class="brand-text d-none d-lg-inline-block">
                            <span>Bootstrap </span><strong>Dashboard</strong></div>
                        <div class="brand-text d-none d-sm-inline-block d-lg-none"><strong>BD</strong></div>
                    </a>
                        <!-- Toggle Button--><a id="toggle-btn" href="#"
                                                class="menu-btn active"><span></span><span></span><span></span></a>
                    </div>
                    <!-- Navbar Menu -->
                    <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                        <!-- Search-->
<!--                        <li class="nav-item d-flex align-items-center"><a id="search" href="#"><i-->
<!--                                class="icon-search"></i></a></li>-->
                        <!-- Notifications-->
                        <li class="nav-item dropdown"><a id="notifications" rel="nofollow" data-target="#" href="#"
                                                         data-toggle="dropdown" aria-haspopup="true"
                                                         aria-expanded="false" class="nav-link"><i
                                class="fa fa-bell-o"></i><span class="badge bg-red badge-corner">12</span></a>
                            <ul aria-labelledby="notifications" class="dropdown-menu">
                                <li><a rel="nofollow" href="#" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-envelope bg-green"></i>You
                                            have 6 new messages
                                        </div>
                                        <div class="notification-time"><small>4 minutes ago</small></div>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-twitter bg-blue"></i>You have
                                            2 followers
                                        </div>
                                        <div class="notification-time"><small>4 minutes ago</small></div>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-upload bg-orange"></i>Server
                                            Rebooted
                                        </div>
                                        <div class="notification-time"><small>4 minutes ago</small></div>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item">
                                    <div class="notification">
                                        <div class="notification-content"><i class="fa fa-twitter bg-blue"></i>You have
                                            2 followers
                                        </div>
                                        <div class="notification-time"><small>10 minutes ago</small></div>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center">
                                    <strong>view all notifications </strong></a></li>
                            </ul>
                        </li>
                        <!-- Messages                        -->
                        <li class="nav-item dropdown"><a id="messages" rel="nofollow" data-target="#" href="#"
                                                         data-toggle="dropdown" aria-haspopup="true"
                                                         aria-expanded="false" class="nav-link"><i
                                class="fa fa-envelope-o"></i><span class="badge bg-orange badge-corner">10</span></a>
                            <ul aria-labelledby="notifications" class="dropdown-menu">
                                <li><a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"><img src="template/img/avatar-1.jpg" alt="..."
                                                                  class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5">Jason Doe</h3><span>Sent You Message</span>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"><img src="template/img/avatar-2.jpg" alt="..."
                                                                  class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5">Frank Williams</h3><span>Sent You Message</span>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item d-flex">
                                    <div class="msg-profile"><img src="template/img/avatar-3.jpg" alt="..."
                                                                  class="img-fluid rounded-circle"></div>
                                    <div class="msg-body">
                                        <h3 class="h5">Ashley Wood</h3><span>Sent You Message</span>
                                    </div>
                                </a></li>
                                <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center">
                                    <strong>Read all messages </strong></a></li>
                            </ul>
                        </li>
                        <!-- Languages dropdown    -->
                        <li class="nav-item dropdown"><a id="languages" rel="nofollow" data-target="#" href="#"
                                                         data-toggle="dropdown" aria-haspopup="true"
                                                         aria-expanded="false"
                                                         class="nav-link language dropdown-toggle"><img
                                src="template/img/flags/16/GB.png" alt="English"><span
                                class="d-none d-sm-inline-block">English</span></a>
                            <ul aria-labelledby="languages" class="dropdown-menu">
                                <li><a rel="nofollow" href="#" class="dropdown-item"> <img
                                        src="template/img/flags/16/DE.png"
                                        alt="English" class="mr-2">German</a>
                                </li>
                                <li><a rel="nofollow" href="#" class="dropdown-item"> <img
                                        src="template/img/flags/16/FR.png"
                                        alt="English" class="mr-2">French
                                </a></li>
                            </ul>
                        </li>
                        <!-- Logout    -->
                        <li class="nav-item"><a onclick="logout()" class="nav-link logout"> <span
                                class="d-none d-sm-inline">Logout</span><i class="fa fa-sign-out"></i></a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="page-content d-flex align-items-stretch">
        <!-- Side Navbar -->
        <nav class="side-navbar">
            <!-- Sidebar Header-->
            <div class="sidebar-header d-flex align-items-center">
                <!--                <div class="avatar"><img src="template/img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle">-->
                <!--                </div>-->
                <div class="title">
                    <h1 class="h4"></h1>
                    <p class="auth"></p>
                </div>
            </div>
            <!-- Sidebar Navidation Menus--><span class="heading">Main</span>
            <ul class="list-unstyled">
                <
                <li class="active"><a href="index.html"> <i class="icon-home"></i>Home </a></li>
                <li><a href="tables.html"> <i class="icon-grid"></i>Tables </a></li>
                <li><a href="charts.html"> <i class="fa fa-bar-chart"></i>Charts </a></li>
                <li><a href="forms.html"> <i class="icon-padnote"></i>Forms </a></li>
                <li><a href="orderBook.html"><i class="icon-grid"></i>订书列表</a> </li>
                <li><a href="#exampledropdownDropdown" aria-expanded="false" data-toggle="collapse"> <i
                        class="icon-interface-windows"></i>买东西 </a>
                    <ul id="exampledropdownDropdown" class="collapse list-unstyled ">
                        <li><a href="publishBook.html">发布二手书</a></li>
                        <li><a href="publishRequest.html">查询二手书</a></li>
                        <li><a href="orderDeal.html">购买二手书</a></li>
                        <!--                        <li><a href="#">Page</a></li>-->
                    </ul>
                </li>
                <li><a href="login.html"> <i class="icon-interface-windows"></i>Login page </a></li>
            </ul>
            <span class="heading">Extras</span>
            <ul class="list-unstyled">
                <li><a href="#"> <i class="icon-flask"></i>Demo </a></li>
                <li><a href="#"> <i class="icon-screen"></i>Demo </a></li>
                <li><a href="#"> <i class="icon-mail"></i>Demo </a></li>
                <li><a href="#"> <i class="icon-picture"></i>Demo </a></li>
            </ul>
        </nav>
        <div class="content-inner">
            <!-- Page Header-->
            <header class="page-header">
                <div class="container-fluid">
                    <h2 class="no-margin-bottom">Tables</h2>
                </div>
            </header>
            <!-- Breadcrumb-->
            <div class="breadcrumb-holder container-fluid">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item active">Tables</li>
                </ul>
            </div>
            <section class="tables">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-6 zky-table">
                            <div class="search-box" style="display: none">
                                <button class="dismiss" onclick="initOrder()"><i class="icon-close"></i></button>
<!--                                <form id="searchForm" action="#" role="search">-->
<!--                                    <input type="text" placeholder="请输入查询书籍 " class="form-control  inputName" id="inputName ">-->
<!--                                    <ul id="searchResult" class="searchResult"></ul>-->
<!--                                </form>-->
                            </div>
                            <div class="card">

                                <div class="card-close">
                                    <div class="dropdown" style="display: inline-block;padding-right:2rem">
                                        <li class="nav-item d-flex align-items-center"><a id="search" href="#"><i class="icon-search"></i></a></li>
                                    </div>
<!--                                    <li class="nav-item d-flex align-items-center"><a id="search1" href="#"><i class="icon-search"></i></a></li>-->
                                    <div class="dropdown" style="float: right">
                                        <button type="button" id="closeCard2" data-toggle="dropdown"
                                                aria-haspopup="true" aria-expanded="false" class="dropdown-toggle"><i
                                                class="fa fa-ellipsis-v"></i></button>
                                        <div aria-labelledby="closeCard2"
                                             class="dropdown-menu dropdown-menu-right has-shadow"><a href="#"
                                                                                                     class="dropdown-item remove">
                                            <i class="fa fa-times"></i>Close</a><a href="#" class="dropdown-item edit">
                                            <i class="fa fa-gear"></i>Edit</a></div>
                                    </div>
                                </div>
                                <div class="card-header d-flex align-items-center">
                                    <h3 class="h4">Striped Table</h3>
                                </div>
<!--                                <li class="nav-item d-flex align-items-center"><a id="search1" href="#"><i class="icon-search"></i></a></li>-->
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>COVER</th>
                                                <th>出售人学号</th>
                                                <th>书名</th>
                                                <th>ISBN</th>
                                                <th style="width: 4em">价格</th>
                                                <th>是否购买</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                                         aria-hidden="true" class="modal fade text-left">
                                        <div role="document" class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h4 id="exampleModalLabel" class="modal-title">确认订单</h4>
                                                    <button type="button" data-dismiss="modal" aria-label="Close"
                                                            class="close"><span aria-hidden="true">×</span></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="project-title d-flex align-items-center" style="margin-bottom: 30px">
                                                        <div class="image has-shadow"><img
                                                                width='50px' height='50px'
                                                                src="template/img/project-4.jpg" alt="..."
                                                                class="img-fluid"></div>
                                                        <div class="text">
                                                            <h3 class="h4" style="line-height: 1.5">Project Title</h3><small>Lorem Ipsum
                                                            Dolor</small>
                                                        </div>
                                                    </div>
                                                    <form >
                                                        <div class="form-group">
                                                            <!--                                                            <label>Password</label>-->
                                                            <input type="password" placeholder="请输入联系地址"
                                                                   class="form-control">

                                                            <input type="text" disabled="" placeholder="" class="form-control h3" style="margin-top: 20px">
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">


                                                    <button type="button" class="btn btn-primary">下单</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </section>
            <!-- Page Footer-->
            <footer class="main-footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <!--                            <p>Copyright &copy; 2019.Company name All rights reserved.<a target="_blank"-->
                            <!--                                                                                         href="http://sc.chinaz.com/moban/">&#x7F51;&#x9875;&#x6A21;&#x677F;</a>-->
                            <!--                            </p>-->
                        </div>
                        <div class="col-sm-6 text-right">
                            <p></p>
                            <!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
</div>
<script>
    <!-- Create a Vue app -->
    let app = new Vue({
        el: '#app',
        data: {
            // 用于存储用户的状态
            state: {
                user: null,
                status: false,
                tip: '正在加载中...'
            },
            // 用于存储app的信息
            info: {
                title: '发布二手书(2)',
                menu: common.publish_book2
            },
            bookSearch: {
                name: '',
                book_list: null,
                open: false,
                isbn: '',
                exchange: 0,
                price: ''
            }
            // 添加其他需要存储的数据
        },
        methods: {
            init: function () {
                common.getAppState((state) => app.state = state)
                // 添加初始化代码
            },
            // 执行模糊查询
            fuzzyBook: function() {
                app.bookSearch.isbn = ''
                request(URL.FuzzyBook, `name=${app.bookSearch.name}`, (res) => {
                    // 成功且有数据
                    if (res.code === 200 && res.data.length > 0) {
                        // 截取前10项
                        app.bookSearch.open = true
                        app.bookSearch.book_list = res.data.slice(0, 10)
                    } else {
                        app.bookSearch.open = false
                        app.bookSearch.book_list = null
                    }
                })
            },
            // 选择了某个数据
            bookSelect: function (index) {
                console.log(`你选择了第${index}项`)
                app.bookSearch.open = false
                app.bookSearch.name = app.bookSearch.book_list[index].name
                app.bookSearch.isbn = app.bookSearch.book_list[index].isbn
            },
            publishBook: function () {

            }
        }
    })

    window.addEventListener('load', () => {
        console.log(`fetch the ${URL.ListBook}`)
        app.init();
    });
</script>
</body>
</html>